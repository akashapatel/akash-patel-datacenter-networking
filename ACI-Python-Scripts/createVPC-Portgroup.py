#!/usr/bin/env python
'''
Autogenerated code using arya.py
Original Object Document Input: 
<?xml version="1.0" encoding="UTF-8"?><imdata totalCount="1"><infraAccPortP annotation="" descr="" dn="uni/infra/accportprof-Heroes_server1" name="Heroes_server1" nameAlias="" ownerKey="" ownerTag="" userdom=":all:"><infraHPortS annotation="" descr="" name="ethernet1_21" nameAlias="" ownerKey="" ownerTag="" type="range" userdom=":all:"><infraRsAccBaseGrp annotation="" fexId="101" tDn="uni/infra/funcprof/accportgrp-Heroes_standard_access" userdom=":all:"/><infraPortBlk annotation="" descr="" fromCard="1" fromPort="21" name="block2" nameAlias="" toCard="1" toPort="21" userdom=":all:"/></infraHPortS></infraAccPortP></imdata>

raise RuntimeError('Please review the auto generated code before ' +
                    'executing the output. Some placeholders will ' +
                    'need to be changed')
'''
# list of packages that should be imported for this code to work
import cobra.mit.access
import cobra.mit.request
import cobra.mit.session
import cobra.model.infra
import cobra.model.pol
from cobra.internal.codec.xmlcodec import toXMLStr
import urllib3
import csv

urllib3.disable_warnings()

def read_csv():
    results = []
    with open('CUSTOMER-leaf107-108-VPC-Portprofile.csv', newline='') as csvfile:
        reader = csv.reader(csvfile, delimiter=',')
        for row in reader:
            results.append(row)
    # re move header
    return results[1:] 
    
# main
def main(host, user, password):

    # log into an APIC and create a directory object
    ls = cobra.mit.session.LoginSession('https://' + host, user, password)
    md = cobra.mit.access.MoDirectory(ls)
    md.login()

    # the top level object on which operations will be made
    polUni = cobra.model.pol.Uni('')
    infraInfra = cobra.model.infra.Infra(polUni)
    infraFuncP = cobra.model.infra.FuncP(infraInfra)
    
    resultList = read_csv()
    
     # Create infra access port profile by the number of rows
    for lst in resultList: 

        infraAccBndlGrp = cobra.model.infra.AccBndlGrp(infraFuncP, annotation='', descr='', lagT='node',
                                                       name= lst[0], nameAlias='', ownerKey='',
                                                       ownerTag='', userdom=':all:')
        infraRsSynceEthIfPolBndlGrp = cobra.model.infra.RsSynceEthIfPolBndlGrp(infraAccBndlGrp, annotation='',
                                                                               tnSynceEthIfPolName='', userdom='all')
        infraRsLinkFlapPol = cobra.model.infra.RsLinkFlapPol(infraAccBndlGrp, annotation='', tnFabricLinkFlapPolName='',
                                                             userdom='all')
        infraRsLacpPol = cobra.model.infra.RsLacpPol(infraAccBndlGrp, annotation='', tnLacpLagPolName=lst[1],
                                                     userdom='all')
        infraRsL2PortAuthPol = cobra.model.infra.RsL2PortAuthPol(infraAccBndlGrp, annotation='', tnL2PortAuthPolName='',
                                                                 userdom='all')
        infraRsL2PortSecurityPol = cobra.model.infra.RsL2PortSecurityPol(infraAccBndlGrp, annotation='',
                                                                         tnL2PortSecurityPolName='', userdom='all')
        infraRsHIfPol = cobra.model.infra.RsHIfPol(infraAccBndlGrp, annotation='', tnFabricHIfPolName=lst[2],
                                                   userdom='all')
        infraRsQosPfcIfPol = cobra.model.infra.RsQosPfcIfPol(infraAccBndlGrp, annotation='', tnQosPfcIfPolName='',
                                                             userdom='all')
        infraRsLldpIfPol = cobra.model.infra.RsLldpIfPol(infraAccBndlGrp, annotation='', tnLldpIfPolName=lst[3],
                                                         userdom='all')
        infraRsFcIfPol = cobra.model.infra.RsFcIfPol(infraAccBndlGrp, annotation='', tnFcIfPolName='', userdom='all')
        infraRsCoppIfPol = cobra.model.infra.RsCoppIfPol(infraAccBndlGrp, annotation='', tnCoppIfPolName='',
                                                         userdom='all')
        infraRsQosDppIfPol = cobra.model.infra.RsQosDppIfPol(infraAccBndlGrp, annotation='', tnQosDppPolName='',
                                                             userdom='all')
        infraRsCdpIfPol = cobra.model.infra.RsCdpIfPol(infraAccBndlGrp, annotation='', tnCdpIfPolName=lst[4],
                                                       userdom='all')
        infraRsAttEntP = cobra.model.infra.RsAttEntP(infraAccBndlGrp, annotation='',
                                                     tDn='uni/infra/attentp-'+lst[5], userdom=':all:')
        infraRsMacsecIfPol = cobra.model.infra.RsMacsecIfPol(infraAccBndlGrp, annotation='', tnMacsecIfPolName='',
                                                             userdom='all')
        infraRsMcpIfPol = cobra.model.infra.RsMcpIfPol(infraAccBndlGrp, annotation='', tnMcpIfPolName='', userdom='all')
        infraRsMonIfInfraPol = cobra.model.infra.RsMonIfInfraPol(infraAccBndlGrp, annotation='', tnMonInfraPolName='',
                                                                 userdom='all')
        infraRsQosEgressDppIfPol = cobra.model.infra.RsQosEgressDppIfPol(infraAccBndlGrp, annotation='',
                                                                         tnQosDppPolName='', userdom='all')
        infraRsStormctrlIfPol = cobra.model.infra.RsStormctrlIfPol(infraAccBndlGrp, annotation='',
                                                                   tnStormctrlIfPolName='', userdom='all')
        infraRsQosIngressDppIfPol = cobra.model.infra.RsQosIngressDppIfPol(infraAccBndlGrp, annotation='',
                                                                           tnQosDppPolName='', userdom='all')
        infraRsL2IfPol = cobra.model.infra.RsL2IfPol(infraAccBndlGrp, annotation='', tnL2IfPolName='', userdom='all')
        infraRsQosSdIfPol = cobra.model.infra.RsQosSdIfPol(infraAccBndlGrp, annotation='', tnQosSdIfPolName='',
                                                           userdom='all')
        infraRsQosLlfcIfPol = cobra.model.infra.RsQosLlfcIfPol(infraAccBndlGrp, annotation='', tnQosLlfcIfPolName='',
                                                               userdom='all')
        infraRsStpIfPol = cobra.model.infra.RsStpIfPol(infraAccBndlGrp, annotation='', tnStpIfPolName='', userdom='all')
        # commit the generated code to APIC
        #print(toXMLStr(infraInfra))
        c = cobra.mit.request.ConfigRequest()
        c.addMo(infraInfra)
        c.addMo(infraFuncP)
        md.commit(c)

if __name__ == '__main__':
    from argparse import ArgumentParser
    parser = ArgumentParser("Create Leaf Interface Profile")
    parser.add_argument('-d', '--host', help='APIC host name or IP', required=True)
    parser.add_argument('-u', '--user', help='user name', required=True)
    parser.add_argument('-p', '--password', help='user password', required=True)
    args = parser.parse_args()

    main(args.host, args.user, args.password)

